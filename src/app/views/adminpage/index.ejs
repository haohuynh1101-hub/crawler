<!DOCTYPE html>
<html>

<!-- Mirrored from coderthemes.com/adminto/vertical_dark/index.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 21 Mar 2019 13:14:52 GMT -->

<head>
  <% include ../partials/head %>

</head>


<body class="fixed-left">

  <!-- Begin page -->
  <div id="wrapper">

    <!-- Top Bar Start -->
    <% include ../partials/topbar %>
    <!-- Top Bar End -->


    <!-- ========== Left Sidebar Start ========== -->
    <!-- Left Sidebar End -->



    <!-- ============================================================== -->
    <!-- Start right Content here -->
    <!-- ============================================================== -->
    <div class="content-page ml-0">
      <!-- Start content -->
      <div class="content">
        <div class="container">
          <nav>
            <div class="nav nav-tabs" id="nav-tab" role="tablist">
              <% if (role.canSuggest) { %>
              <a class="nav-item nav-link active" id="nav-suggest-tab" data-toggle="tab" href="#suggest" role="tab"
                aria-controls="suggest" aria-selected="true">Suggest</a>
              <% } %>
              <% if (role.canBacklink) { %>
              <a class="nav-item nav-link " id="nav-click-backlink-tab" data-toggle="tab" href="#click-backlink"
                role="tab" aria-controls="click-backlink" aria-selected="false">Click Backlink</a>
              <% } %>
              <% if (role.canClickAD) { %>
              <a class="nav-item nav-link " id="nav-click-ad-tab" data-toggle="tab" href="#click-ad" role="tab"
                aria-controls="click-ad" aria-selected="false">Click Ad</a>
              <% } %>

            </div>
          </nav>

          <div class="tab-content" id="nav-tabContent">
            <% if (role.canSuggest) { %>
            <% include ./feature-partials/suggest/suggest %>
            <% } %>
            <% if (role.canBacklink) { %>
            <% include ./feature-partials/click-backlink/click-backlink %>
            <% } %>
            <% if (role.canClickAD) { %>
            <% include ./feature-partials/click-ad/click-ad %>
            <% } %>


          </div>
        </div> <!-- container -->

        <!-- ============================================================== -->
        <!-- End Right content here -->
        <!-- ============================================================== -->


        <!-- Right Sidebar -->
        <!-- /Right-bar -->

        <!-- ============================================================== -->
        <!-- End Right content here -->
        <!-- ============================================================== -->


        <!-- Right Sidebar -->
        <!-- /Right-bar -->

      </div>
      <!-- END wrapper -->

      <% include ./modal-setTimer %>

      <% include ../partials/scripts %>
      <script src="/socket.io/socket.io.js"></script>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
      <script>
        var selectedId = '';
      </script>
      <script>
        var socket = io('https://seo.seotuts.vn/');
        socket.on('server-send-current-useragent', (data) => {
          $(`span[agent="${data.projectId}"]`).text(data.data);
          appendLog(data.projectId, 'Thay đổi User Agent thành công');
        })

        socket.on('server-send-current-url', (data) => {
          appendLog(data.projectId, data.url);
          appendLog(data.projectId, 'Đang lả lướt trên trang ...')
        })

        socket.on('not found url', (projectId) => {
          appendLog(projectId, "Không tìm thấy url hoặc title khớp với truy vấn ở thiết bị đang giả lập, đang chuyển sang thiết bị khác ...");
        })

        socket.on('invalid-query', () => {
          appendLog('Tiêu đề hoặc URL đã nhập không khớp với bất kì kết quả tìm kiếm nào, vui lòng thử lại !');
          alert('Tiêu đề hoặc URL đã nhập không khớp với bất kì kết quả tìm kiếm nào, vui lòng thử lại !')
        })
        socket.on('changing-agent', (projectId) => {
          appendLog(projectId, 'Đang thay đổi User Agent ...');
        })
        socket.on('go-google', (projectId) => {
          console.log('dang den google')
          appendLog(projectId, "https://www.google.com/");
        })

        socket.on('close-brower', (projectId) => {
          appendLog(projectId, 'Đang đóng trình duyệt ...')
        })

        socket.on('next-page', (projectId) => {
          appendLog(projectId, 'Không tìm thấy domain ở trang hiện tại, đang chuyển sang trang kế ...')
        })

        socket.on('send-id', async (id) => {
          console.log('server-send-id: '+id);
          await localStorage.setItem('id', id);
          await sendNewSocketAndUserID();
        })

        socket.on('changing-agent-backlink', (projectId) => {
          console.log('id nhan dc: ' + projectId);
          appendLog(projectId, 'Đang thay đổi user agent ...');
        })

        socket.on('agent-backlink', (data) => {
          $(`span[agent="${data.projectId}"]`).text(data.data);
          appendLog(data.projectId, 'User agent hiện tại: ' + data.data);
        })

        socket.on('send-domain-backlink', (data) => {
          appendLog(data.projectId, 'Đang truy cập: ' + data.backlink);
        })

        socket.on('finding-backlink', (data) => {
          appendLog(data.projectId, `Đang tìm kiếm đường dẫn đến site chính trên trang ${data.urlBacklink}`)
        })

        socket.on('found-backlink', (data) => {
          appendLog(data.projectId, `Đã tìm thấy url site chính, đang truy cập ${data.mainURL}`);
        })

        socket.on('not-found-backlink', (projectId) => {
          appendLog(projectId, 'Không tìm thấy site chính trong backlink , vui lòng thử lại sau !!!');
        })

        socket.on('send-random-url', data => {
          appendLog(data.projectId, 'Đang click url ngẫu nhiên trên trang ...');
          appendLog(data.projectId, 'URL hiện tại: ' + data.url);
        })

        socket.on('not-found-keyword-backlink', data => {
          appendLog(data.projectId, 'Không tìm thấy url cần view trên trang' + data.urlBacklink);
        })

        socket.on('not-found-ad', data => {
          appendLog(data.projectId, 'url backlink không hợp lệ hoặc không tìm thấy bất kì url quảng cáo nào trùng khớp, vui lòng kiểm tra lại !!!');
        })

        socket.on('not-found-single-ad', data => {
          appendLog(data.projectId,'dm may')
          appendLog(data.projectId, `Không tìm thấy url quảng cáo "${data.adURL}" hoặc url trang chứa quảng cáo không hợp lệ`);
        })

        socket.on('send-changing-agent-ad', data => {
          appendLog(data.projectId, 'Đang thay đổi user agent ...');
        })

        socket.on('send-current-agent-ad', data => {
          $(`span[agent=${data.projectId}]`).text(data.agent);
          appendLog(data.projectId, `User agent hiện tại: ${data.agent}`);
        })

        socket.on('send-gotodomain-ad', data => {
          appendLog(data.projectId, `Đang truy cập "${data.domain}"`);
        })

        socket.on('send-found-ad', data => {
          appendLog(data.projectId, `Đã tìm thấy url quảng cáo : ${data.adURL}, đang truy cập ...`);
        })

        socket.on('send-stop-suggest', data => {
          console.log('stopped')
          appendLog(data.projectId, `Đã dừng`);
          location.reload();
        })

        socket.on('send-stop-ad', data => {
          console.log('stopped')
          appendLog(data.projectId, `Đã dừng`);
          location.reload();
        })

        socket.on('send-stop-backlink', data => {
          console.log('stopped')
          appendLog(data.projectId, `Đã dừng`);
          location.reload();
        })

        socket.on('send-invalid-backlink',data=>{
         location.reload();
        })

        socket.on('send-invalid-domain-ad',data=>{
          alert('asdfasdf')
          console.log('dmddmmdsmmm')
         //location.reload();
        })

        socket.on('send-test',projectId=>{
          console.log('dm')
        })
        //save selected project id in javascript tag to use later
        const saveID = (id) => {
          selectedId = id;
        }

        //these functions is just a supporters to pass project id to main functions berfore run
        const scheduleSupportRunSuggest = () => {
          alert(`Đã lên lịch chạy lúc : ${$('#clock_suggest').val()} ${$('#date_suggest').val()}`);
          runSuggestTool(selectedId, false);
        }
        const scheduleSupportRunBacklink = () => {
          alert(`Đã lên lịch chạy lúc : ${$('#clock_backlink').val()} ${$('#date_backlink').val()}`);
          runBackLinkTool(selectedId, false);
        }
        const scheduleSupportRunAD = () => {
          alert(`Đã lên lịch chạy lúc : ${$('#clock_ad').val()} ${$('#date_ad').val()}`);
          runAdLinkTool(selectedId, false);
        }


        /**
         * run suggest tool
         * id: projectid
         * isRunNow {boolean} run now or run later (base on schedule)
        */
        const runSuggestTool = (id, isRunNow) => {

          $('#listLogSuggest').empty();
          $(`#btnRun-${id}`).attr("disabled", true);
          window.location.href = '/';
          $.post("/suggest",
            {
              userid: localStorage.getItem('userid'),
              projectId: id,
              isRunNow: isRunNow,
              day: $('#date_suggest').val().split('-')[2],
              month: $('#date_suggest').val().split('-')[1],
              hour: $('#clock_suggest').val().split(':')[0],
              minute: $('#clock_suggest').val().split(':')[1],
              second: 0
            },
            function (data, status) {
              //console.log(data);
            });
        }

        /**
         * run backlink project
         * id: projectid
         * isRunNow {boolean} run now or run later (base on schedule)
        */
        const runBackLinkTool = (id, isRunNow) => {


          $(`#btnBackLinkRun-${id}`).attr("disabled", true);

          window.location.href = '/';

          $.post("/backlink",
            {
              userid: localStorage.getItem('userid'),
              projectId: id,
              isRunNow: isRunNow,
              day: $('#date_backlink').val().split('-')[2],
              month: $('#date_backlink').val().split('-')[1],
              hour: $('#clock_backlink').val().split(':')[0],
              minute: $('#clock_backlink').val().split(':')[1],
              second: 0
            },
            function (data, status) {

              // console.log(data);
            });
        }


        //save config
        function saveProject() {
          let validate = CheckValideSuggest();
          if (validate.err) {
            alert("Please insert" + validate.message);
            return false;
          }


          $.post("/addproject",
            {
              keyword: JSON.stringify($('#suggestKeyword').val().split('\n')),
              domain: $('#domain').val(),
              isAutochangeUserAgent: JSON.parse($('#useragent').is(":checked")),
              delay: $('#delay-suggest').val(),
              amount: $('#suggestTime').val(),
              socketID: localStorage.getItem('id'),
              name: $('#projectName').val(),
              searchTool: $('#searchingTools').val()
            },
            function (data, status) {
              window.location.href = '/';
            });
        }
        //view suggest project
        function viewProject(id) {
          $('#view-logBox').children(0).attr("id", id);
          $('#currentUserAgent').attr('agent', id);
          $.get(`/project/${id}`).done(function (data) {
            $('#view-projectName').text(data.name);
            //$('#view-suggestKeyword').text(data.keyword);
            $('#view-domain').text(data.domain);
            $('#view-delay-suggest').text(data.delay);
            $('#view-suggestTime').text(data.amount);
            $('#view-searchingTools').text(data.searchTool);

            data.keyword.map(item => {

              $('#view-suggestKeyword').val($('#view-suggestKeyword').val() + `\n${item}`);
            })

            data.log.map((item) => {
              $(`#${id}`).prepend(`<li>${item.message}</li>`);
            })

          })
        }
        //view backlink project
        function viewBackProject(id) {

          //set up some id to render view detail
          $('#viewLogbox_backlink').children(0).attr("id", id);
          $('#currentAgent_backlink').attr('agent', id);

          $.get(`/backlinkproject/${id}`).done(function (data) {
            $('#view-main_url_backlink').text(data.mainURL);
            $('#view-keyword').text(data.keyword);
            $('#view-delay_backink').text(data.delay);
            $('#view-amount_backlink').text(data.amount);

            data.urlBacklink.map(item => {
              $('#view-url_backlink').val($('#view-url_backlink').val() + `\n${item}`);
            })
            data.log.map((item) => {
              $(`#${id}`).prepend(`<li>${item.message}</li>`);
            })

          })
        }
        //valide data
        function CheckValide(listInput) {
          listInput.forEach(element => {
            element.css("border-color", "#E3E3E3");
          });
          for (let element of listInput) {
            if (element.val() == "") {
              element.focus();
              element.css("border-color", "red")
              return { err: true, message: element.attr('data-focus') };
            }
          }
          return { err: false };
        }
        //valide data Back link
        function CheckValideBackLink() {
          let domainBacklink = $('#domain_backlink');
          let backlink = $('#backlink');
          let delayBackLink = $('#delay_backink');

          return (CheckValide([domainBacklink, backlink, delayBackLink]));
        }
        //valide data suggest
        function CheckValideSuggest() {
          let suggestKeyword = $('#suggestKeyword');
          let domain = $('#domain');
          let delaySuggest = $('#delay-suggest');
          let projectName = $("#projectName")
          return (CheckValide([projectName, suggestKeyword, domain, delaySuggest]));
        }

        //validate data click ad
        function CheckValideAD() {
          let name = $('#projectName_ad');
          let main_url = $('#main_url_ad');
          let ad_url = $('#ad_url');
          let delay = $("#delay_ad")
          return (CheckValide([name, main_url, ad_url, delay]));
        }

        // accept only positve number in input
        function acceptPositiveNumber(event) {
          return (event.charCode >= 48 && event.charCode <= 57) ? true : event.preventDefault();
        }
        //append log
        function appendLog(projectId, messageLog) {
          let timeLog = new Date();
          let log = `${timeLog.getHours() > 10 ? timeLog.getHours() : '0' + timeLog.getHours()}:`
            + `${timeLog.getMinutes() > 10 ? timeLog.getMinutes() : '0' + timeLog.getMinutes()}:`
            + `${timeLog.getSeconds() > 10 ? timeLog.getSeconds() : '0' + timeLog.getSeconds()}:`
            + `  ${messageLog}`;
          $(`#${projectId}`).prepend(`<li>${log}</li>`);
        }



        const sendNewSocketAndUserID = () => {
          $.post("/sendSocket",
            {
              userid: localStorage.getItem('userid'),
              socketid: localStorage.getItem('id')
            },
            function (data, status) {

            });
        }

        const saveBackLinkProject = () => {

          let validate = CheckValideBackLink();
          if (validate.err) {
            alert("Please insert" + validate.message);
            return false;
          }

          $.post("/saveProjectBacklink",
            {
              urlBacklink: JSON.stringify($('#url_backlink').val().split('\n')),
              mainURL: $('#main_url').val(),
              delay: $('#delay_backink').val(),
              amount: $('#amount_backlink').val(),
              name: $('#projectName_backlink').val()
            },
            function (data, status) {
              window.location.href = '/';
            });
        }

        //save new ad project
        const saveAD = () => {

          let validate = CheckValideAD();
          if (validate.err) {
            alert("Please insert " + validate.message);
            return false;
          }

          $.post("/saveAdProject",
            {
              adURL: JSON.stringify($('#ad_url').val().split('\n')),
              domain: $('#main_url_ad').val(),
              delay: $('#delay_ad').val(),
              amount: $('#amount_ad').val(),
              name: $('#projectName_ad').val()
            },
            function (data, status) {
              window.location.href = '/';
            });
        }

        const viewAdProject = (id) => {

          //set up some id to render view detail
          $('#viewLogbox_ad').children(0).attr("id", id);
          $('#currentAgent_ad').attr('agent', id);

          $.get(`/ad/${id}`).done(function (data) {
            $('#view-name_ad').text(data.name);
            //$('#view-ad_url').text(data.adURL);
            $('#view-main_url_ad').text(data.domain);
            $('#view-delay_ad').text(data.delay);
            $('#view-amount_ad').text(data.amount);

            data.adURL.map(item => {

              $('#view-ad_url').val($('#view-ad_url').val() + `\n${item}`);
            })

            data.log.map((item) => {
              $(`#${id}`).prepend(`<li>${item.message}</li>`);
            })

          })
        }

        /**
         * run click ad tool
        * id: projectid
        * isRunNow {boolean} run now or run later (base on schedule)
        */
        const runAdLinkTool = (id, isRunNow) => {

          $(`#btnADRun-${id}`).attr("disabled", true);

          window.location.href = '/';

          $.post("/clickAd",
            {
              userid: localStorage.getItem('userid'),
              projectId: id,
              isRunNow: isRunNow,
              day: $('#date_ad').val().split('-')[2],
              month: $('#date_ad').val().split('-')[1],
              hour: $('#clock_ad').val().split(':')[0],
              minute: $('#clock_ad').val().split(':')[1],
              second: 0
            },
            function (data, status) {

              //console.log(data);
            });
        }


        const deleteSuggest = (id) => {

          $.get(`/deleteSuggest/${id}`).done(function (data) {

            location.reload();
          })
        }

        const deleteBacklink = (id) => {

          $.get(`/deleteBacklink/${id}`).done(function (data) {

            location.reload();
          })
        }

        const deleteAD = (id) => {

          $.get(`/deleteAD/${id}`).done(function (data) {

            location.reload();
          })
        }

        const stopSuggest=(id)=>{
          console.log('stop functin')
          $.get(`/stopSuggest/${id}`).done(function (data) {

            location.reload();
          })
        }

        const stopAD=(id)=>{
          console.log('stop functin')
          $.get(`/stopAD/${id}`).done(function (data) {

            location.reload();
          })
        }

        const stopBacklink=(id)=>{
          console.log('stop functin')
          $.get(`/stopBacklink/${id}`).done(function (data) {

            location.reload();
          })
        }
      </script>
</body>

<!-- Mirrored from coderthemes.com/adminto/vertical_dark/index.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 21 Mar 2019 13:15:13 GMT -->

</html>